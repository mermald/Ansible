---
- name: Install Spacewalk repo
  yum:
    name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm
    state: present

- name: Install Spacewalk repo
  yum:
    name: http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
    state: present

- name: Install rhn-client-tools
  yum:
    name: rhn-client-tools
    state: present

- name: Install rhn-check
  yum:
    name: rhn-check

- name: Install rhn-setup
  yum:
    name: rhn-setup

- name: Install rhnsd
  yum:
    name: rhnsd

- name: Install m2crypto
  yum:
    name: m2crypto

- name: Install yum-rhn-plugin
  yum:
    name: yum-rhn-plugin

- name: Install epel-release
  yum:
    name: epel-release
    state: present

- name: Get Spacewalk Cert
  yum:
    name: http://spacewalk.sphere.us/pub/rhn-org-trusted-ssl-cert-1.0-1.noarch.rpm
    state: present

- name: Register system with Spacewalk
  command:
    name: "rhnreg_ks --serverUrl=http://spacewalk.sphere.us/XMLRPC --activationkey=1-a679786505204c5e376b342386bd5aba"
